<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Detail - Honeypot Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <header class="dashboard-header">
        <div class="header-content">
            <div class="header-left">
                <a href="/operator" class="back-link">‚Üê Back to Dashboard</a>
                <h1>Event Detail: {{ event_id }}</h1>
            </div>
            <div class="header-right">
                <a href="/operator/logout" class="logout-btn">üö™ Logout</a>
            </div>
        </div>
        <div class="warning-bar">
            {{ security_warning }}
        </div>
    </header>

    <main class="event-detail-main">
        <div id="event-detail-container">
            Loading event details...
        </div>
    </main>

    <script>
        // Load event detail
        fetch(`/api/event/{{ event_id }}`)
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('event-detail-container');
                
                if (data.error) {
                    container.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                    return;
                }
                
                const event = data.event;
                const enrichment = data.enrichment;
                
                container.innerHTML = `
                    <div class="event-detail-grid">
                        <section class="detail-section">
                            <h2>Basic Information</h2>
                            <table class="detail-table">
                                <tr><td><strong>Event ID:</strong></td><td>${event.id}</td></tr>
                                <tr><td><strong>Timestamp:</strong></td><td>${event.timestamp}</td></tr>
                                <tr><td><strong>Client IP:</strong></td><td>${event.client_ip}</td></tr>
                                <tr><td><strong>Method:</strong></td><td>${event.method || 'POST'}</td></tr>
                                <tr><td><strong>Endpoint:</strong></td><td>${event.endpoint || '/login'}</td></tr>
                                <tr><td><strong>Attack Type:</strong></td><td>${event.attack_type || 'login_attempt'}</td></tr>
                            </table>
                        </section>
                        
                        <section class="detail-section">
                            <h2>üåç Geolocation</h2>
                            <table class="detail-table">
                                <tr><td><strong>Country:</strong></td><td>${event.country || 'Unknown'}</td></tr>
                                <tr><td><strong>Region:</strong></td><td>${event.region || 'Unknown'}</td></tr>
                                <tr><td><strong>City:</strong></td><td>${event.city || 'Unknown'}</td></tr>
                                <tr><td><strong>Latitude:</strong></td><td>${event.latitude || 0}</td></tr>
                                <tr><td><strong>Longitude:</strong></td><td>${event.longitude || 0}</td></tr>
                                <tr><td><strong>ISP:</strong></td><td>${event.isp || 'Unknown'}</td></tr>
                            </table>
                        </section>
                        
                        <section class="detail-section">
                            <h2>Form Data</h2>
                            <pre class="json-display">${JSON.stringify(event.form_data || {}, null, 2)}</pre>
                        </section>
                        
                        <section class="detail-section">
                            <h2>Headers</h2>
                            <pre class="json-display">${JSON.stringify(event.headers || {}, null, 2)}</pre>
                        </section>
                        
                        <section class="detail-section">
                            <h2>User Agent</h2>
                            <div class="user-agent">${event.user_agent || 'Unknown'}</div>
                        </section>
                        
                        <section class="detail-section">
                            <h2>‚ö° Enrichment Status</h2>
                            <div class="enrichment-status">
                                <div class="status-item ${enrichment.geolocation_available ? 'success' : 'warning'}">
                                    Geolocation: ${enrichment.geolocation_available ? 'Yes' : 'No'}
                                </div>
                                <div class="status-item ${enrichment.country_detected ? 'success' : 'warning'}">
                                    Country: ${enrichment.country_detected ? 'Yes' : 'No'}
                                </div>
                                <div class="status-item ${enrichment.isp_detected ? 'success' : 'warning'}">
                                    ISP: ${enrichment.isp_detected ? 'Yes' : 'No'}
                                </div>
                                <div class="status-item ${enrichment.user_agent_parsed ? 'success' : 'warning'}">
                                    User Agent: ${enrichment.user_agent_parsed ? 'Yes' : 'No'}
                                </div>
                            </div>
                        </section>
                        
                        <section class="detail-section full-width">
                            <h2>Raw JSON</h2>
                            <pre class="json-display">${JSON.stringify(event.raw_json || {}, null, 2)}</pre>
                        </section>
                    </div>
                `;
            })
            .catch(error => {
                document.getElementById('event-detail-container').innerHTML = 
                    `<div class="error">Failed to load event details: ${error}</div>`;
            });
    </script>
</body>
</html>
